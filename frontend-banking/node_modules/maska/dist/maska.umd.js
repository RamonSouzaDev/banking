/*! maska v2.1.11 | (c) Alexander Shabunevich | Released under the MIT license */
(function(c,p){typeof exports=="object"&&typeof module<"u"?p(exports):typeof define=="function"&&define.amd?define(["exports"],p):(c=typeof globalThis<"u"?globalThis:c||self,p(c.Maska={}))})(this,function(c){"use strict";var J=Object.defineProperty;var N=(c,p,d)=>p in c?J(c,p,{enumerable:!0,configurable:!0,writable:!0,value:d}):c[p]=d;var g=(c,p,d)=>(N(c,typeof p!="symbol"?p+"":p,d),d);const p={"#":{pattern:/[0-9]/},"@":{pattern:/[a-zA-Z]/},"*":{pattern:/[a-zA-Z0-9]/}};class d{constructor(t={}){g(this,"opts",{});g(this,"memo",new Map);const s={...t};if(s.tokens!=null){s.tokens=s.tokensReplace?{...s.tokens}:{...p,...s.tokens};for(const e of Object.values(s.tokens))typeof e.pattern=="string"&&(e.pattern=new RegExp(e.pattern))}else s.tokens=p;Array.isArray(s.mask)&&(s.mask.length>1?s.mask=[...s.mask].sort((e,a)=>e.length-a.length):s.mask=s.mask[0]??""),s.mask===""&&(s.mask=null),this.opts=s}masked(t){return this.process(t,this.findMask(t))}unmasked(t){return this.process(t,this.findMask(t),!1)}isEager(){return this.opts.eager===!0}isReversed(){return this.opts.reversed===!0}completed(t){const s=this.findMask(t);if(this.opts.mask==null||s==null)return!1;const e=this.process(t,s).length;return typeof this.opts.mask=="string"?e>=this.opts.mask.length:typeof this.opts.mask=="function"?e>=s.length:this.opts.mask.filter(a=>e>=a.length).length===this.opts.mask.length}findMask(t){const s=this.opts.mask;if(s==null)return null;if(typeof s=="string")return s;if(typeof s=="function")return s(t);const e=this.process(t,s.slice(-1).pop()??"",!1);return s.find(a=>this.process(t,a,!1).length>=e.length)??""}escapeMask(t){const s=[],e=[];return t.split("").forEach((a,i)=>{a==="!"&&t[i-1]!=="!"?e.push(i-e.length):s.push(a)}),{mask:s.join(""),escaped:e}}process(t,s,e=!0){if(s==null)return t;const a=`value=${t},mask=${s},masked=${e?1:0}`;if(this.memo.has(a))return this.memo.get(a);const{mask:i,escaped:h}=this.escapeMask(s),r=[],m=this.opts.tokens!=null?this.opts.tokens:{},l=this.isReversed()?-1:1,R=this.isReversed()?"unshift":"push",y=this.isReversed()?0:i.length-1,j=this.isReversed()?()=>o>-1&&k>-1:()=>o<i.length&&k<t.length,L=u=>!this.isReversed()&&u<=y||this.isReversed()&&u>=y;let O,M=-1,o=this.isReversed()?i.length-1:0,k=this.isReversed()?t.length-1:0,T=!1;for(;j();){const u=i.charAt(o),f=m[u],E=(f==null?void 0:f.transform)!=null?f.transform(t.charAt(k)):t.charAt(k);if(!h.includes(o)&&f!=null?(E.match(f.pattern)!=null?(r[R](E),f.repeated?(M===-1?M=o:o===y&&o!==M&&(o=M-l),y===M&&(o-=l)):f.multiple&&(T=!0,o-=l),o+=l):f.multiple?T&&(o+=l,k-=l,T=!1):E===O?O=void 0:f.optional&&(o+=l,k-=l),k+=l):(e&&!this.isEager()&&r[R](u),E===u&&!this.isEager()?k+=l:O=u,this.isEager()||(o+=l)),this.isEager())for(;L(o)&&(m[i.charAt(o)]==null||h.includes(o));)e?r[R](i.charAt(o)):i.charAt(o)===t.charAt(k)&&(k+=l),o+=l}return this.memo.set(a,r.join("")),this.memo.get(a)}}const w=n=>JSON.parse(n.replaceAll("'",'"')),S=(n,t={})=>{const s={...t};return n.dataset.maska!=null&&n.dataset.maska!==""&&(s.mask=C(n.dataset.maska)),n.dataset.maskaEager!=null&&(s.eager=v(n.dataset.maskaEager)),n.dataset.maskaReversed!=null&&(s.reversed=v(n.dataset.maskaReversed)),n.dataset.maskaTokensReplace!=null&&(s.tokensReplace=v(n.dataset.maskaTokensReplace)),n.dataset.maskaTokens!=null&&(s.tokens=V(n.dataset.maskaTokens)),s},v=n=>n!==""?!!JSON.parse(n):!0,C=n=>n.startsWith("[")&&n.endsWith("]")?w(n):n,V=n=>{if(n.startsWith("{")&&n.endsWith("}"))return w(n);const t={};return n.split("|").forEach(s=>{const e=s.split(":");t[e[0]]={pattern:new RegExp(e[1]),optional:e[2]==="optional",multiple:e[2]==="multiple",repeated:e[2]==="repeated"}}),t};class b{constructor(t,s={}){g(this,"items",new Map);g(this,"beforeinputEvent",t=>{const s=t.target,e=this.items.get(s);e.isEager()&&"inputType"in t&&t.inputType.startsWith("delete")&&e.unmasked(s.value).length<=1&&this.setMaskedValue(s,"")});g(this,"inputEvent",t=>{if(t instanceof CustomEvent&&t.type==="input"&&t.detail!=null&&typeof t.detail=="object"&&"masked"in t.detail)return;const s=t.target,e=this.items.get(s),a=s.value,i=s.selectionStart,h=s.selectionEnd;let r=a;if(e.isEager()){const m=e.masked(a),l=e.unmasked(a);l===""&&"data"in t&&t.data!=null?r=t.data:l!==e.unmasked(m)&&(r=l)}if(this.setMaskedValue(s,r),"inputType"in t&&(t.inputType.startsWith("delete")||i!=null&&i<a.length))try{s.setSelectionRange(i,h)}catch{}});this.options=s,typeof t=="string"?this.init(Array.from(document.querySelectorAll(t)),this.getMaskOpts(s)):this.init("length"in t?Array.from(t):[t],this.getMaskOpts(s))}destroy(){for(const t of this.items.keys())t.removeEventListener("input",this.inputEvent),t.removeEventListener("beforeinput",this.beforeinputEvent);this.items.clear()}needUpdateOptions(t,s){const e=this.items.get(t),a=new d(S(t,this.getMaskOpts(s)));return JSON.stringify(e.opts)!==JSON.stringify(a.opts)}needUpdateValue(t){const s=t.dataset.maskaValue;return s==null&&t.value!==""||s!=null&&s!==t.value}getMaskOpts(t){const{onMaska:s,preProcess:e,postProcess:a,...i}=t;return i}init(t,s){for(const e of t){const a=new d(S(e,s));this.items.set(e,a),e.value!==""&&this.setMaskedValue(e,e.value),e.addEventListener("input",this.inputEvent),e.addEventListener("beforeinput",this.beforeinputEvent)}}setMaskedValue(t,s){const e=this.items.get(t);this.options.preProcess!=null&&(s=this.options.preProcess(s));const a=e.masked(s),i=e.unmasked(e.isEager()?a:s),h=e.completed(s),r={masked:a,unmasked:i,completed:h};s=a,this.options.postProcess!=null&&(s=this.options.postProcess(s)),t.value=s,t.dataset.maskaValue=s,this.options.onMaska!=null&&(Array.isArray(this.options.onMaska)?this.options.onMaska.forEach(m=>m(r)):this.options.onMaska(r)),t.dispatchEvent(new CustomEvent("maska",{detail:r})),t.dispatchEvent(new CustomEvent("input",{detail:r}))}}const A=new WeakMap,P=n=>{setTimeout(()=>{var t;((t=A.get(n))==null?void 0:t.needUpdateValue(n))===!0&&n.dispatchEvent(new CustomEvent("input"))})},W=(n,t)=>{const s=n instanceof HTMLInputElement?n:n.querySelector("input"),e={...t.arg};if(s==null||(s==null?void 0:s.type)==="file")return;P(s);const a=A.get(s);if(a!=null){if(!a.needUpdateOptions(s,e))return;a.destroy()}if(t.value!=null){const i=t.value,h=r=>{i.masked=r.masked,i.unmasked=r.unmasked,i.completed=r.completed};e.onMaska=e.onMaska==null?h:Array.isArray(e.onMaska)?[...e.onMaska,h]:[e.onMaska,h]}A.set(s,new b(s,e))};c.Mask=d,c.MaskInput=b,c.tokens=p,c.vMaska=W,Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});
